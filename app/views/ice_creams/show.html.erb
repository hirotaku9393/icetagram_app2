<div class="pt-4">  
    <div class="pt-4 mx-auto bg-amber-50 shadow-md rounded-3xl p-6 max-w-4xl mt-6 text-center">
        <%= turbo_frame_tag "ice_cream_show" do %>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                <div class="pl-4">
                    <h1 class="text-4xl font-kiwi"> <%= @ice_cream.name %> </h1>
                    <% if @ice_cream.user.present? %>
                        <div class="flex items-center justify-center gap-2 pt-5">
                            <% if @ice_cream.user.image_url.present? %>
                                <%= image_tag @ice_cream.user.image_url, class: "w-10 h-10 rounded-full" %>
                            <% else %>
                                <iconify-icon icon="mdi:user" width="24" height="24"></iconify-icon>
                            <% end %>
                            <h2 class="text-xl font-kiwi "> <%= @ice_cream.user.name %> </h2>
                        </div>
                    <% end %>
                    <h2 class="text-xl font-kiwi pt-5"> <%= "コメント: " + @ice_cream.comment %> </h2>
                    <h2 class="text-2 pt-3"xl font-kiwi pt-5"> <%= "アレンジ: " + @ice_cream.arrange %> </h2>
                    <h2 class="text-2 pt-3"xl font-kiwi pt-5"> <%= "カロリー値: " + @ice_cream.calorie_value.to_s + "kcal" %> </h2>
                    <h2 class="text-xl font-kiwi pt-5" data-turbo="false"> タグ: <%= render 'tag', ice_cream: @ice_cream %></h2>
                    <% if @ice_cream.image.attached? %>
                        <h3 class="pt-10  flex justify-center"><%= image_tag @ice_cream.image, class: 'h-40 w-auto' %></h3>
                    <% else %>
                        <h3 class="pt-10 flex justify-center"><%= image_tag 'Icecream.png', class: 'h-40 w-auto' %></h3>
                    <% end %>    
                </div> 
                <div class="pl-4">
                    <div data-controller="ice-cream-chart"
                    data-ice-cream-chart-chart-data-value="<%= @chart.to_vector.to_json %>"
                    data-ice-cream-chart-labels-value="<%= ['甘さ', '爽やかさ', '濃厚さ', 'カロリー', '具材の充実感'].to_json %>">
                    <canvas data-ice-cream-chart-target="canvas" width="400" height="200"></canvas>
                </div>
            </div>
        <% end %>
    </div>
</div>

<div class="pt-4 flex justify-center ">
    <%= render 'favorite_button', ice_cream: @ice_cream %>
</div>

<div class="flex justify-center mt-6 ">
    <div class="pt-6 mx-auto bg-amber-50 shadow-md rounded-3xl w-full max-w-3xl p-6 mt-6 text-center">
        <h3 class="text-2xl font-kiwi mb-4 text-center">みんなのひと口レポ</h3>

        <% @ice_cream.reviews.each do |review| %>
            <div class="justify-center review-box border p-3 mb-4 rounded-3xl  bg-yellow-200 w-64 sm:w-96 mx-auto">
                
                <% if review.user %>
                    <div class="flex items-center justify-start space-x-2 text-sm text-gray-500">
                        <% if review.user.image_url.present? %>
                            <%= image_tag review.user.image_url, class: "w-10 h-10 rounded-full" %>
                        <% else %>
                            <iconify-icon icon="mdi:user" width="24" height="24"></iconify-icon>
                        <% end %>
                        
                        <p class="text-sm text-gray-500"><%= review.user.name %>さん</p>
                    </div>
                <% end %>

                <p class="flex items-center font-kiwi justify-start text-sm lg:text-base"><%= review.content %></p>


                <% if review.user == current_user %>
                    <%= link_to "削除",
                        ice_cream_review_path(@ice_cream, review),
                        data: { turbo_method: :delete, turbo_confirm: "削除してよろしいですか？" },
                        class: "text-red-500 text-sm" %>
                <% end %>
            </div>
        <% end %>

            <hr class="my-4">

            <%= form_with model: [@ice_cream, Review.new], local: true do |f| %>
            <div class="mb-3">
                <%= f.text_area :content,
                    rows: 3,
                    placeholder: "あいすの感想を書いてね",
                    class: "w-64 sm:w-96 p-2 border rounded" %>
            </div>

            <%= f.submit "投稿", class: "px-4 py-2 bg-blue-500 text-grey rounded-3xl hover:-lg font-kiwi bg-yellow-200" %>
        <% end %>
    </div>
</div>

<div class="flex flex-col items-center mt-6 w-full">
    <h2 class="text-center text-2xl font-kiwi pt-5 py-4">楽天市場での検索結果</h2>
            <% if @goods.any? %>
                <div class="flex flex-row items-center text-center grid grid-cols-1 sm:grid-cols-2 max-w-4xl gap-8">
                    <% @goods.first(2).each do |item| %>
                        <div class="goods-img">
                            <img src="<%= item['mediumImageUrls'][0]%>" class="max-h-32 max-w-32 object-contain mx-auto">
                        </div>
                        <div class="goods-name">
                            <a href="<%= item['itemUrl'] %>" target="_blank" class= 'font-kiwi hover:text-gray-500'><%= item['itemName']  %></a>
                        </div>
                    <% end %>
                </div>
            <% else %>
                <p class="text-gray-500 font-kiwi">楽天市場での検索結果がありません</p>
            <% end %>
        </div>
</div>

<div class="flex justify-center mt-6">
    <div class="grid gap-4 lg:gap-6 place-items-center <%= current_user == @ice_cream.user ? 'grid-cols-1 sm:grid-cols-2' : 'grid-cols-1' %>">
        <% if current_user == @ice_cream.user %>
            <%= link_to 'あいすを編集', edit_ice_cream_path(@ice_cream), class: 'flex justify-center bg-stone-300 hover:bg-stone-400 text-stone-800 text-lg font-kiwi py-4 px-8 rounded-3xl text-center whitespace-nowrap  w-52' %>  
            <%= button_to 'あいすを削除', ice_cream_path(@ice_cream), method: :delete, data: { turbo_confirm: '本当に削除しますか？' }, class: 'flex justify-center bg-stone-300 hover:bg-stone-400 text-stone-800 text-lg font-kiwi py-4 px-8 rounded-3xl text-center whitespace-nowrap  w-52' %>
        <% end %> 
    </div>
</div>


